<!DOCTYPE html>
<html>
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
        <link href="style.css" rel="stylesheet" type="text/css" />
        <style>
            /* CSS */

        </style>

        <title>Title</title>
    </head>
    <body>
        <!-- HTML -->


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <!-- <script src="script.js"></script> -->
        <script type="module">

            // import kaboom.js
            import kaboom from "https://unpkg.com/kaboom@3000.0.1/dist/kaboom.mjs";

            // initialize kaboom context
            kaboom();

            loadSprite("background", "sprites/sky.jpg");
            const SPEED = 320

            add([
                sprite("background"),
                pos(0, 0),
                scale(0.7), // Adjust scale to fit the screen
                fixed(), // Keeps the background static
            ]);

            // Load the sprites
            const objs = ["wolf", "grass", "pan"];

            for (const obj of objs) {
                loadSprite(obj, `/sprites/${obj}.png`);
            }


            // Load assets
            loadSprite("goat", "/sprites/blueGoat.png")

            // Set the gravity acceleration (pixels per second)
            setGravity(1600)

            // Add player game object
            const player = add([
                sprite("goat"),
                pos(center()),
                area(),
                scale(0.2),
                // respond to gravity so that the player
                body(),
            ])

            //makes it so that the player does not move outside of the screen towards the left
            onUpdate(() => {
                player.pos.x = Math.max(0, Math.min(width(), player.pos.x));
            });

            // Function to spawn falling objects
            function spawnObject() {
                const name = choose(objs);
                add([
                    sprite(name),
                    area(),
                    pos(rand(0, width()), 0), // Spawn at random position at the top
                    scale(0.1),
                    anchor("bot"),
                    "fallingObject",
                    name, // Assign tag with object name
                    { speed: rand(80, 150) }, // Random fall speed
                ]);
                wait(0.5, spawnObject); // Continuously spawn objects
            }

                onUpdate("fallingObject", (obj) => {
                obj.move(0, obj.speed);
                if (obj.pos.y - obj.height > height()) {
                    destroy(obj);
                }
            });

            let scoreValue = 10;

            // Display score at the bottom-left
            const score = add([
                text(`Score: ${scoreValue}`, { size: 24 }),
                pos(50, 50),
                color(0, 0, 0),
                fixed(),
            ]);

            // Function to check win condition
            function checkWinCondition() {
                if (scoreValue >= 20) {
                    endGame();
                }
            }

            function endGame() {
            // Stop spawning objects
            get("fallingObject", (obj) => destroy(obj));

            // Stop player movement
            player.hidden = true;

            // Display "YOU WIN" text in black at the center
            add([
                text("YOU WIN", { size: 64 }),
                pos(width() / 2, height() / 2),
                color(0, 0, 0), // Black font color
                anchor("center"),
            ]);
        }


            // Player collects grass when colliding with it
            player.onCollide("grass", (g) => {
                destroy(g); // Remove grass object
                scoreValue += 5; // Increase score by 5
                score.text = `Score: ${scoreValue}`; // Update the score display
                checkWinCondition(); // Check if player has won

            });

            spawnObject();



            add([
                rect(width(), 48),
                outline(4),
                area(),
                pos(0, height() - 48),
                // Give objects a body() component if you don't want other solid objects pass through
                body({ isStatic: true }),
            ])


            // registers an event that runs every frame as long as user is holding a certain key
            onKeyDown("left", () => {
                // .move() is provided by pos() component, move by pixels per second
                player.move(-SPEED, 0)
            })

            onKeyDown("right", () => {
                player.move(SPEED, 0)
            })

        </script>
    </body>
</html>
